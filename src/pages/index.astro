---
import Layout from '../layouts/Layout.astro';


---

<Layout>
	<section class="seccion seccion-main" id="main" data-index="0" data-status="active">
	</section>
	<section class="seccion seccion-our-story" id="our-story" data-index="1" data-status="unknown">
	</section>
	<section class="seccion seccion-info" id="info" data-index="2" data-status="unknown">
	</section>
</Layout>

<style>
	.seccion {
		width: 100%;
		height: 100vh;
		position: absolute;
	}
	.seccion-main {
		background-color: #da62c4;
		top: 0px;
	}
	.seccion-our-story {
		background-color: blue;
		top: 100vh;
	}
	.seccion-info {
		background-color: chocolate;
		top: 100vh;
	}
	.move-up{
		top: -100vh;
		transition: all 1s;
	}
	.move-down{
		top: 100vh;
		transition: all 1s;
	}
	.move-center{
		top: 0px;
		transition: top 1s;
	}
</style>

<script>
	let deltaY: number;

	function debounce (callback: Function, waitTime: number) {
		let timerId: ReturnType<typeof setTimeout>;
		let execute = true;
		console.log('Entra en debounce')
		return () => {
			console.log('entre en return')
			if(execute) {
				const executed = callback();
				if(executed) {
					execute = false;
				}
			}
			clearTimeout(timerId);
			timerId = setTimeout(() => {
				execute = true
			}, waitTime) 
		}
	}

	const upOrDown = () : boolean => {
		console.log(deltaY)
		const currentSection: HTMLElement|null = document.querySelector(`[data-status="active"]`);

		if(!currentSection || !currentSection.getAttribute('data-index')) return false;

		if(deltaY < 0) {
			console.log('sube')
			const nextIndex = +(currentSection.getAttribute('data-index') ?? 1) - 1;
			const nextSection: HTMLElement|null = document.querySelector(`[data-index="${nextIndex}"]`);
			if(!nextSection) return false;
			currentSection.dataset.status = "unknown";
			currentSection.classList.remove('move-center');
			currentSection.classList.add('move-down');
			nextSection.dataset.status = "active";
			nextSection.classList.remove('move-up');
			nextSection.classList.add('move-center');

			return true;
		}
		if(deltaY > 0) {
			console.log('baja')
			const nextIndex = +(currentSection.getAttribute('data-index') ?? -1) + 1;
			const nextSection: HTMLElement|null = document.querySelector(`[data-index="${nextIndex}"]`);
			if(!nextSection) return false;
			currentSection.dataset.status = "unknown";
			currentSection.classList.remove('move-center');
			currentSection.classList.add('move-up');
			nextSection.dataset.status = "active";
			nextSection.classList.remove('move-down');
			nextSection.classList.add('move-center');
			return true;

		}
		return false;
	}

	const debounceUpOrDown = debounce(upOrDown, 500);
	
	const onScroll = (e: WheelEvent) => {
		deltaY = e.deltaY;
		debounceUpOrDown()
		// debounce(upOrDown, e.deltaY, 200);
	}

	document.addEventListener('wheel', onScroll)

</script>

